# Amazon Elastic File System (EFS)

Amazon EFS는 AWS 클라우드 서비스와 온프레미스 리소스에서 사용할 수 있는 간단하고 확장 가능하며 탄력적인 완전관리형 NFS (Network File System) 파일 시스템입니다. 애플리케이션 중단 없이 온디맨드 방식으로 페타바이트 규모까지 확장 가능하며, 파일 추가/제거에 따라 자동으로 확장 및 축소됩니다. 따라서 사용자는 확장 규모에 맞춰 용량을 프로비저닝 및 관리할 필요가 없습니다.

## 주요 특징

*   **공유 스토리지:** 여러 대의 EC2 인스턴스와 동시에 연결 가능하며, EC2 간 공유가 필요한 자원 (예: 세션 관리, 소스 코드 저장) 저장에 적합합니다.
*   **NFS 기반:** NFSv4 프로토콜을 지원하는 공유 스토리지입니다.
*   **탄력적인 용량 확장:** EBS와 달리 사전에 용량을 지정할 필요 없이 사용한 만큼 용량이 자동으로 증가하며, 페타바이트 단위까지 확장이 가능합니다.
*   **높은 동시 접속성:** 수천 개의 EC2 인스턴스가 동시에 접속을 유지할 수 있습니다.
*   **높은 데이터 안정성:** 데이터는 여러 AZ (가용 영역)에 분산 저장되어 데이터 손실 위험이 낮습니다.
*   **강력한 일관성 (Read After Write):** 데이터를 기록하자마자 다른 EC2 인스턴스들이 바로 읽어들일 수 있습니다.
*   **프라이빗 서비스:** AWS 외부에서 직접 접속이 불가능하며, 외부 접속을 위해서는 VPN 또는 Direct Connect 등을 통해 VPC와 연결해야 합니다.
*   **가용 영역별 마운트 대상:** 각 가용 영역에 마운트 대상 (Mount Target)을 두고, 각 가용 영역에서 해당 마운트 대상으로 접근합니다.
*   **Linux 전용:** Windows에서는 사용할 수 없습니다.

## EFS 성능 모드 (EFS performanc mode)

*   **General Purpose (범용):** 대부분의 워크로드에 적합한 일반적인 성능 모드입니다.
*   **Max I/O (최대 I/O):** 매우 높은 IOPS가 필요한 경우에 적합합니다 (예: 빅데이터, 미디어 처리 등).

## EFS 처리량 모드 (EFS throughput mode)

*   **Bursting Throughput (버스팅 처리량):** 낮은 처리량일 때 크레딧을 모아 높은 처리량이 필요할 때 사용하는 방식입니다 (EC2 T 타입과 유사).
*   **Provisioned Throughput (프로비저닝된 처리량):** 필요한 만큼의 처리량을 미리 확보해두고 사용하는 방식입니다.

## EFS 스토리지 클래스 (EFS storage class)

*   **EFS Standard:** 3개 이상의 가용 영역에 데이터를 저장하여 높은 가용성과 내구성을 제공합니다.
*   **EFS Standard-IA (Infrequent Access):** 3개 이상의 가용 영역에 데이터를 저장하지만, 액세스 빈도가 낮은 데이터를 저장하여 비용을 절감합니다. 데이터를 가져올 때 추가 비용이 발생합니다.
*   **EFS One Zone:** 단일 가용 영역에 데이터를 저장하여 비용을 더욱 절감하지만, 해당 가용 영역의 장애에 영향을 받을 수 있습니다.
*   **EFS One Zone-IA:** 단일 가용 영역에 데이터를 저장하며, 액세스 빈도가 낮은 데이터를 저장하여 비용을 최소화합니다. 데이터를 가져올 때 추가 비용이 발생합니다. 장기 보관용 데이터에 적합합니다.

## Amazon FSx

EFS 외에도 AWS는 Windows 및 고성능 컴퓨팅 워크로드를 위한 파일 시스템 서비스를 제공합니다.

*   **FSx for Windows File Server:** Windows 환경을 위한 완전 관리형 파일 시스템 서비스로, SMB 프로토콜을 사용하며 Microsoft Active Directory와 통합됩니다. Linux, macOS 등 다른 OS에서도 접근 가능합니다.
*   **FSx for Lustre:** Linux 기반의 고성능 병렬 파일 시스템으로, 머신 러닝, 고성능 컴퓨팅 (HPC), 비디오 처리 등 대규모 데이터 처리에 적합합니다. 온프레미스에서도 접속 가능합니다.

## 실습 시나리오 (EFS를 활용한 스토리지 공유 웹 서비스)

1.  EFS를 위한 보안 그룹 생성
2.  EFS 생성
3.  EC2 인스턴스 3개 프로비저닝
4.  각 EC2 인스턴스에 EFS 마운트
5.  웹 서버 생성 및 실행
6.  각 웹 서버에서 스토리지를 공유하는지 확인

## EBS 와의 비교

| 특징          | EBS                                 | EFS                               |
| ----------- | ----------------------------------- | --------------------------------- |
| 연결 대상      | 단일 EC2 인스턴스 (Multi-Attach 가능) | 여러 EC2 인스턴스 동시 연결 가능     |
| 용량 관리      | 사전에 용량 지정 필요                | 사용량에 따라 자동 확장/축소         |
| 사용 사례      | 운영 체제 부팅, 애플리케이션 데이터 저장 | 공유 파일 저장, 세션 관리, 소스 코드 저장 |
| 접근 방식      | 블록 스토리지                        | 파일 스토리지 (NFS)               |
